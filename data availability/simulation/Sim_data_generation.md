## RNA-seq datasets generation for benchmark

The simulation study was inspired by https://github.com/kkrizanovic/RNAseqEval, and make some difference and important to our study. The simulation workflow in our study was given here.

Synthetic datasets were created from following genomes and corresponding gene annotation:
  - Homo Sapiens GRCh38 (human) Reference genome, and annotations from Ensemble.
  - Mus Musculus GRCm39 (mouse) Reference genome, and annotations from Ensemble.
  - Drosophila melanogaster DM6 (fruit fly) genome, and annotations from Ensemble.
 ---

We built two categories of simulated transcriptomes. The first category only has one simulated transcriptome (called as “H-all” transcriptome) which is from all the coding genes of human, and the second category has three simulated transcriptomes (called as “H-se”, “M-se” and “F-se” transcriptomes respectively) which are from three sets of randomly selected genes of human, mouse and fruit fly, respectively. Each of the transcriptomes was used to generate a series of simulated datasets with various sequencing models. The following are some details for the generation of “H-se”, “M-se” and “F-se” transcriptomes and datesets.

RNA-seq simulation datasets were generated by the following workflow:
  1. Download reference genome and annotation file with the same version information. The annotation file should contain the comprehensive gene annotations on the reference chromosomes only. This is the main annotation for most users. Or you can filter gene annotations on scaffolds, assembly patches and alternate loci if there exists.
  2. Extract genes with single splicing isoform, genes with alternative splicing isoforms and genes with short exons (< 30bp). For each kinds of genes, output all the corresponding annotations into three different files by suffix “_AS.gtf”, “_SS.gtf” and “_short.gtf” separately.
  3. Generate transcriptomes from pre-processed three kinds of annotations and reference genome. Filter transcripts short than 200 bps and combine generated transcriptomes together for the input of PBSIM and NanoSim.
 
### 1. Filter annotations not on chromosomes
As we know, the annotation file download from Ensemble contains all the gene annotations on chromosomes, scaffolds, assemble patches and alternate loci. But many of the scaffolds are unfinshed that should be removed. Or user can download file contains the comprehensive gene annotations on the reference chromosomes only which can be found at GENCODE.

### 2. Extract annotations of different gene types into groups
RNA-seq data is the products of gene transcription, but one gene may transcribe more than one isoforms due to alternative splicing of gene. What's more, an RNA aligner need to not only map exons to genome but also recognize isoforms of genes to reflect the gene structure. Thus, in order to reveal the performance of aligners mapping RNA-seq data to reference genome, we need to simulate RNA-seq data from different aspects to close to real data. In simulation, annotations for each species were seperated into three groups. The first group contains annotations for genes with single splicing isoform, the second group contains annotations for genes with alternative splicing isoforms, the third group contains annotations for genes with short exons (< 30bp). All annotations of each group will be output into files and suffixed by "_SS.gtf", "_AS.gtf" and "_short.gtf" separately. For alternative splicing genes, all isoforms will be extracted. Annotation grouping was down using Annotation_Load.py script in this repository, i.e.

```
python Annotation_grouping.py genome.gtf
```
### 3. Generating transcriptomes
Transcriptomes are generated from processed annotations and genome reference using the script generate_transcriptome.py (city from https://github.com/kkrizanovic/RNAseqEval) in this repository. Since the annotations were separated into three groups, a transcriptom (or a set of transcripts) was generated for each group.
```python
python generate_transcriptome.py SS.gtf ref.fa SS_transcriptome.fa
python generate_transcriptome.py AS.gtf ref.fa AS_transcriptome.fa
python generate_transcriptome.py short.gtf ref.fa short_transcriptome.fa
```
We combine the three transcriptome files together and then filter transcripts short than 200bp, this was done using fastqfilter.py script from https://github.com/isovic/samscripts with option minlen. The filtered transcriptome file is the input of PBSIM.
```
cat SS_transcriptome.fa AS_transcriptome.fa short_transcriptome.fa > merge_transcriptome.fa
python fastqfilter minlen 200 merge_transcriptome.fa > transcriptome_filter.fa
```
### 4. Simulation using PBSIM2
We simulated 24 long RNA-seq read datasets with three organisms: Homo sapiens GRCh38 (human), Mus musculus GRCm39 (mouse), and Drosophila melanogaster r6 (fruit fly); four sequencing settings with different sequence error rates and simulation models of simulator (i.e., D1, D2, D3 and D4); two sequencing depth: 10x and 30x using PBsim2 (version v2.0). The P6C4 chemistry model of PBsim2 was used to generate PacBio-like datasets, in which D1 with 1% error rate and D2 with 15% error rate represented PacBio high identify and error-prone RNA-seq reads respectively. For Oxford Nanopore platform, R103 and R95 model were used and two parameter settings for D3 with 1% error rate and D4 with 5% error rate represented the reads generated by R10.3 and R9.5 nanopores respectively. For each model, there were 6 simulated datasets from three species based on Ensemble gene annotations, so there are total 24 simulated datasets will be generated by the following command lines:
```
The D1 reads:
        pbsim 	Transcripome_File (human, mouse, fruitfly) \
        --id-prefix SimG2_S/SimG3_S \
        --depth 10/30 \
        --accuracy-mean 0.99\
        --hmm_model P6C4.model
```
```
The D2 reads: 
	pbsim 	Transcripome_File (human, mouse, fruitfly) \
        --id-prefix SimG2_S/SimG3_S \
        --depth 10/30 \
        --accuracy-mean 0.85\
        --hmm_model P6C4.model
```
```
The D3 reads: 
	pbsim 	Transcripome_File (human, mouse, fruitfly) \
        --id-prefix SimG2_S/SimG3_S \
        --depth 10/30 \
        --accuracy-mean 0.99\
        --hmm_model R103.model
```

```
The D4 reads: 
	pbsim 	Transcripome_File (human, mouse, fruitfly) \
        --id-prefix SimG2_S/SimG3_S \
        --depth 10/30 \
        --accuracy-mean 0.95\
        --hmm_model R95.model
```

---
### One example for generation simulation dataset
Here is the pipeline of reads simulation, take fruitfly reference and annotations for example.

#### Get dataset
The reference genome and processed gene annotations of fruitfly can be download from https://hgdownload.soe.ucsc.edu/goldenPath/dm6/bigZips/dm6.fa.gz and https://hgdownload.soe.ucsc.edu/goldenPath/dm6/bigZips/genes/dm6.ensGene.gtf.gz

The following scripts give the pipeline of simulation data generation.
```
python Annotation_grouping.py dm6.ensGene.gtf

python generate_transcriptome.py AS.gtf dm6.fa AS_transcriptome.fa

python generate_transcriptome.py SS.gtf dm6.fa SS_transcriptome.fa

python generate_transcriptome.py short.gtf dm6.fa short_transcriptome.fa

cat AS_transcriptome.fa SS_transcriptome.fa short_transcriptome.fa > merge_transcriptome.fa

python samscripts/src/fastqfilter.py minlen 200 merge_transcriptome.fa transcriptome_for_simulation.fa

mkdir   D1 D2 D3 D4

cd D1
bash simulate_D1.sh
cd ..

cd D2
bash simulate_D2.sh
cd ..

cd D3
bash simulate_D3.sh
cd ..

cd D4
bash simulate_D4.sh
cd ..
```

The content of simulate_D1.sh, simulate_D2.sh, simulate_D3.sh and simulate_D4.sh are similar, the difference is the parameters for simulation different type of reads and sequencing depth. Here is an example of simulate_CCS.sh:
```
mkdir group2 group3

cd group2
pbsim  transcriptome_for_simulation.fa \
       --id-prefix SimG2_S \
       --depth 10 \
       --accuracy-mean 0.99\
      --hmm_model P6C4.model
cd ..

cat group2/*.fastq > dataset_sim_dm_CCS_g2.fastq

rm group2/*.fastq

cd group3
pbsim  transcriptome_for_simulation.fa \
       --id-prefix SimG3_S \
       --depth 30 \
       --accuracy-mean 0.99\
      --hmm_model P6C4.model
cd ..

cat group3/*.fastq > dataset_sim_dm_CCS_g3.fastq

rm group3/*.fastq

cd ../..